# Android Build Artifacts & Clean Build Guide

## What are `.cxx` files?

The `.cxx` folder is generated by Android's build system when building native C++ code. In React Native projects, these are **temporary build artifacts** that include:

### Contents of `.cxx` folder:
- **CMake configuration files** - Build system metadata
- **Compiled object files** - Intermediate C++ compilation outputs
- **Debug symbols** - Debugging information
- **Build metadata** - Timestamps, dependency graphs, etc.

### Why are they generated?
1. **React Native's Architecture** - React Native uses C++ for:
   - JSI (JavaScript Interface)
   - Fabric (New Architecture rendering)
   - TurboModules (Native module system)
   - Hermes JavaScript engine integration

2. **Native Modules** - Many third-party libraries include native C++ code:
   - `react-native-reanimated`
   - `react-native-gesture-handler`
   - `react-native-worklets`
   - Audio/video processing libraries

3. **Performance** - C++ code is used for performance-critical operations

## âš ï¸ Important: These files should NEVER be committed to Git!

### Why NOT commit them?
1. **Machine-specific** - Built for your specific computer/OS
2. **Large files** - Can be hundreds of MB
3. **Regenerated automatically** - Created fresh on each build
4. **Cause conflicts** - Different machines generate different files
5. **Build failures** - Stale artifacts can cause mysterious errors

## âœ… Your Project is Already Configured Correctly!

Your `.gitignore` file already ignores these files:

```gitignore
# Android NDK / C++ build artifacts
android/.cxx/
android/app/.cxx/
android/.externalNativeBuild/
android/app/.externalNativeBuild/
.cxx/
```

## ğŸ§¹ How to Clean Build Artifacts

### Method 1: Quick Clean (Recommended for daily use)
```bash
npm run clean:android
```
This runs `gradlew clean` which removes basic build artifacts.

### Method 2: Deep Clean (Recommended when you have build issues)
**Windows:**
```bash
npm run clean:android:deep
# OR directly:
cd android
clean-build.bat
```

**macOS/Linux:**
```bash
cd android
chmod +x clean-build.sh
./clean-build.sh
```

This removes:
- `.gradle/` - Gradle cache
- `build/` - All build outputs
- `app/build/` - App-specific build outputs
- `.cxx/` - C++ build artifacts âœ“
- `app/.cxx/` - App-specific C++ artifacts âœ“
- `.externalNativeBuild/` - External native build files
- `app/.externalNativeBuild/` - App-specific external native build files

### Method 3: Nuclear Clean (When all else fails)
```bash
# Run deep clean
npm run clean:android:deep

# Clear React Native cache
npx react-native clean-cache

# Clear npm cache
npm cache clean --force

# Reinstall dependencies
rm -rf node_modules
npm install

# Rebuild
npm run android
```

## ğŸ”§ When to Clean Build

### Clean build is recommended when:
- âœ… Switching between git branches
- âœ… After updating React Native version
- âœ… After adding/removing native modules
- âœ… When you see "Duplicate class" errors
- âœ… When you see "CMake" or "ninja" errors
- âœ… After pulling changes that modify `build.gradle`
- âœ… When the app crashes on startup after rebuild
- âœ… When you see "Cannot find symbol" errors
- âœ… After changing `gradle.properties` or `local.properties`

### You DON'T need to clean when:
- âŒ Making JavaScript/TypeScript code changes only
- âŒ Updating app styles or UI components
- âŒ Normal day-to-day development
- âŒ After every single build (wasteful)

## ğŸš€ Best Practices

### 1. Before Building
```bash
# For a fresh start
npm run clean:android:deep
npm run android
```

### 2. Daily Development
```bash
# Just build normally
npm run android
```

### 3. Troubleshooting Build Issues
```bash
# Step 1: Stop any running Metro bundlers
# Press Ctrl+C in Metro terminal

# Step 2: Deep clean
npm run clean:android:deep

# Step 3: Clear watchman
watchman watch-del-all

# Step 4: Rebuild
npm run android
```

### 4. Keep Your Repo Clean
```bash
# Check what's tracked in git (should NOT see .cxx)
git status

# If you accidentally committed .cxx files:
git rm -r --cached android/.cxx
git rm -r --cached android/app/.cxx
git commit -m "Remove .cxx build artifacts from git"
```

## ğŸ“Š Understanding Build Performance

### Build Time Comparison:
- **Incremental Build** (no clean): 30-60 seconds
- **Clean Build** (after `gradlew clean`): 3-5 minutes
- **Deep Clean Build** (after removing all artifacts): 5-10 minutes

### Why Incremental Builds are Faster:
- Gradle reuses `.cxx` artifacts from previous builds
- Only changed files are recompiled
- CMake caches configuration

### When Clean Builds are Necessary:
- Gradle's incremental build can't detect all changes
- CMake cache can become stale
- Native dependencies change

## ğŸ› Common Issues & Solutions

### Issue 1: "Execution failed for task ':app:configureCMakeDebug'"
**Solution:** Deep clean build
```bash
npm run clean:android:deep
npm run android
```

### Issue 2: "ninja: error: unknown target"
**Solution:** Remove .cxx and rebuild
```bash
cd android
rm -rf app/.cxx app/build
./gradlew assembleDebug
```

### Issue 3: "Duplicate class found"
**Solution:** Clean and rebuild
```bash
npm run clean:android:deep
npm run android
```

### Issue 4: Build works on one machine but not another
**Solution:** Ensure .cxx is NOT in git, deep clean on both machines
```bash
# Check git
git ls-files | grep .cxx  # Should return nothing

# Clean on problematic machine
npm run clean:android:deep
npm run android
```

## ğŸ“ What Gets Generated in .cxx?

```
android/app/.cxx/
â”œâ”€â”€ Debug/
â”‚   â”œâ”€â”€ <build-hash>/
â”‚   â”‚   â”œâ”€â”€ arm64-v8a/      # 64-bit ARM (most modern devices)
â”‚   â”‚   â”œâ”€â”€ armeabi-v7a/    # 32-bit ARM (older devices)
â”‚   â”‚   â”œâ”€â”€ x86/            # 32-bit emulator
â”‚   â”‚   â””â”€â”€ x86_64/         # 64-bit emulator
â”‚   â””â”€â”€ build_command.txt
â””â”€â”€ refs/
    â””â”€â”€ cmake_build_cache.txt
```

Each architecture folder contains:
- `.ninja` files - Build system files
- `.o` files - Compiled object files
- `.so` files - Shared libraries (copied to APK)
- CMake metadata

## ğŸ¯ Summary

### Key Takeaways:
1. **`.cxx` files are temporary** - Always regenerated on build
2. **Already properly ignored** - Your .gitignore is correct âœ“
3. **Clean when needed** - Use `npm run clean:android:deep` for issues
4. **Never commit** - Build artifacts should never be in git
5. **Machine-specific** - Different for each developer's environment

### Quick Reference Commands:
```bash
# Daily use - normal build
npm run android

# Having issues? - deep clean
npm run clean:android:deep

# Nuclear option - full reset
npm run clean:android:deep && rm -rf node_modules && npm install
```

---

**Need more help?** Check the main README or open an issue on GitHub.

