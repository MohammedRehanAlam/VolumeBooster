# 🔊 VolumeBooster - Technical Documentation

## 📋 Table of Contents
1. [Project Overview](#project-overview)
2. [Architecture](#architecture)
3. [Technical Implementation](#technical-implementation)
4. [Background Processing](#background-processing) ⭐ **NEW**
5. [File Structure](#file-structure)
6. [API Reference](#api-reference)
7. [Development Guide](#development-guide)
8. [Integration Guide](#integration-guide)
9. [Troubleshooting](#troubleshooting)

## 🎯 Project Overview

VolumeBooster is a React Native application that provides advanced audio enhancement capabilities beyond standard system volume limits. The app uses Android's LoudnessEnhancer API to apply real-time audio processing and boost audio levels up to 200% (50 dB gain) with **background processing support**.

### Key Features
- **Volume Control**: Standard device volume (0-100%)
- **Audio Boost**: Enhanced audio levels (0-200%)
- **Dual Boost Modes**: App-only vs Device-wide audio processing
- **Real-time Monitoring**: Live audio device and volume tracking
- **Safety Features**: Color-coded warnings and safety alerts
- **Test Sound**: Built-in audio verification system
- **Theme Support**: Automatic dark/light theme detection
- **🔄 Background Processing**: ⭐ **NEW** - Continuous boost even when app is closed

## 🏗️ Architecture

### High-Level Architecture
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   React Native  │    │   TypeScript     │    │   Android       │
│   UI Layer      │◄──►│   Bridge Layer   │◄──►│   Native Layer  │
│                 │    │                  │    │                 │
│ • VolumeBooster │    │ • VolumeBooster  │    │ • VolumeBooster │
│   Component     │    │   Module         │    │   Module.kt     │
│ • User Controls │    │ • Event Emitter  │    │ • Audio APIs    │
│ • State Mgmt    │    │ • Type Safety    │    │ • LoudnessEnh.  │
│ • Theme System  │    │ • Event Handling │    │ • Session Mgmt  │
│ • Background UI │    │ • Service Control │    │ • VolumeBooster │
│   Controls      │    │   Methods         │    │   Service.kt    │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

### Data Flow
1. **User Interaction** → React Native UI Component
2. **State Update** → Component State Management
3. **Native Call** → TypeScript Interface Bridge
4. **Audio Processing** → Android Native Module
5. **Audio Enhancement** → LoudnessEnhancer API
6. **Real-time Updates** → Event Emitter → UI Updates

## 🔧 Technical Implementation

### Audio Boost Algorithm
The core audio enhancement uses Android's LoudnessEnhancer API with the following formula:

```
boostLevel * 25 = gain in millibels (mB)
1000 mB = 1 dB
```

**Examples:**
- 100% boost = 25 dB gain
- 200% boost = 50 dB gain

### Session Management
The app supports two boost modes through Android AudioSessionId management:

#### App-Only Mode
- Uses unique `audioSessionID` generated by AudioManager
- Only affects audio from this specific app
- Perfect for notifications, app sounds, test tones

#### Device-Wide Mode  
- Uses session ID `0` (global)
- Affects all device audio
- Applies to music, videos, games, system sounds

### Real-Time Monitoring
The app implements continuous background monitoring for:

#### Device Monitoring
- **Frequency**: Every 1.8 seconds
- **Purpose**: Detect audio device changes (Bluetooth, headphones, speakers)
- **Event**: `audioDeviceChanged`

#### Volume Monitoring
- **Frequency**: Every 500ms
- **Purpose**: Track system volume changes
- **Event**: `volumeChanged`

## 🔄 Background Processing ⭐ **NEW**

### Background Service Architecture
VolumeBooster now includes a comprehensive background processing system that allows audio boost to continue working even when the app is closed or backgrounded.

### Background Service Components

#### **VolumeBoosterService.kt**
- **Type**: Android Foreground Service
- **Purpose**: Maintains audio boost functionality in background
- **Features**:
  - Persistent notification with boost level display
  - Independent LoudnessEnhancer instance
  - Service binding for React Native communication
  - Automatic cleanup on service termination

#### **Service Lifecycle Management**
```
Background Mode Toggle ON
    ↓
Start Foreground Service
    ↓
Bind Service to React Native Module
    ↓
Apply Current Boost Settings
    ↓
Show Persistent Notification
    ↓
Monitor Service Health (Every 2 seconds)
```

#### **Background Service Features**
- **Continuous Boost**: Audio enhancement works even when app is closed
- **Persistent Notification**: Shows current boost level and mode
- **Service Health Monitoring**: Automatic status checking every 2 seconds
- **Battery Optimization**: Efficient background operation
- **Instant Control**: Seamless toggle without popup interruptions

### Background Service API

#### **Service Control Methods**
```typescript
// Enable/disable background mode
await VolumeBoosterModule.setBackgroundMode(enabled: boolean): Promise<boolean>

// Check if background mode is enabled
await VolumeBoosterModule.isBackgroundModeEnabled(): Promise<boolean>

// Check if background service is running
await VolumeBoosterModule.isBackgroundServiceRunning(): Promise<boolean>

// Get current boost level from background service
await VolumeBoosterModule.getBackgroundBoostLevel(): Promise<number>

// Check if boost is active in background service
await VolumeBoosterModule.isBackgroundBoostActive(): Promise<boolean>
```

#### **Background Service Permissions**
Required Android permissions for background operation:
```xml
<uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
<uses-permission android:name="android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK" />
<uses-permission android:name="android.permission.WAKE_LOCK" />
```

#### **Service Configuration**
```xml
<service
  android:name=".VolumeBoosterService"
  android:enabled="true"
  android:exported="false"
  android:foregroundServiceType="mediaPlayback" />
```

### Background Processing Flow
1. **User Enables Background Mode**: Toggle switch in UI
2. **Service Starts**: VolumeBoosterService starts as foreground service
3. **Service Binds**: React Native module binds to service
4. **Boost Applied**: Current boost settings applied to service
5. **Notification Shows**: Persistent notification displays boost status
6. **Continuous Operation**: Boost continues even when app is closed
7. **Health Monitoring**: Service status checked every 2 seconds
8. **User Disables**: Service stops and notification disappears

## 📁 File Structure

### React Native Layer
```
src/
├── components/
│   └── VolumeBooster.tsx      # Main UI component (720+ lines, self-contained)
├── modules/
│   └── VolumeBoosterModule.ts # TypeScript interface (220+ lines)
└── index.ts                  # Main exports
```

### Android Native Layer
```
android/app/src/main/java/com/volumebooster/
├── VolumeBoosterModule.kt     # Core audio processing (784+ lines)
├── VolumeBoosterService.kt   # Background foreground service (314+ lines) ⭐ NEW
├── VolumeBoosterPackage.kt    # Module registration
├── MainActivity.kt           # Android activity
└── MainApplication.kt        # Application class
```

### Configuration Files
```
├── App.tsx                   # App entry point with theme management
├── package.json              # Dependencies and scripts
├── tsconfig.json             # TypeScript configuration
├── babel.config.js           # Babel configuration
├── metro.config.js           # Metro bundler configuration
└── jest.config.js            # Testing configuration
```

## 📚 API Reference

### Native Module Methods

#### `initializeAudio(): Promise<number>`
Initializes the audio system and returns maximum volume level.
```typescript
const maxVolume = await VolumeBoosterModule.initializeAudio();
```

#### `setVolume(volume: number): Promise<void>`
Sets device volume level (0-100%).
```typescript
await VolumeBoosterModule.setVolume(75); // 75% volume
```

#### `setBoost(boostLevel: number): Promise<void>`
Sets audio boost level (0-200%).
```typescript
await VolumeBoosterModule.setBoost(150); // 150% boost (37.5 dB)
```

#### `setAppOnlyBoost(enabled: boolean): Promise<void>`
Toggles between app-only and device-wide boost modes.
```typescript
await VolumeBoosterModule.setAppOnlyBoost(true); // App-only mode
```

#### `playTestSound(): Promise<void>`
Plays a 440Hz test tone for boost verification.
```typescript
await VolumeBoosterModule.playTestSound();
```

#### `getAudioDeviceInfo(): Promise<AudioDeviceInfo | null>`
Gets information about the currently active audio device.
```typescript
const deviceInfo = await VolumeBoosterModule.getAudioDeviceInfo();
```

### Background Service Methods ⭐ **NEW**

#### `setBackgroundMode(enabled: boolean): Promise<boolean>`
Enables or disables background mode for continuous audio boost.
```typescript
const result = await VolumeBoosterModule.setBackgroundMode(true); // Enable background mode
```

#### `isBackgroundModeEnabled(): Promise<boolean>`
Checks if background mode is currently enabled.
```typescript
const isEnabled = await VolumeBoosterModule.isBackgroundModeEnabled();
```

#### `isBackgroundServiceRunning(): Promise<boolean>`
Checks if the background service is currently running.
```typescript
const isRunning = await VolumeBoosterModule.isBackgroundServiceRunning();
```

#### `getBackgroundBoostLevel(): Promise<number>`
Gets the current boost level from the background service.
```typescript
const boostLevel = await VolumeBoosterModule.getBackgroundBoostLevel();
```

#### `isBackgroundBoostActive(): Promise<boolean>`
Checks if boost is currently active in the background service.
```typescript
const isActive = await VolumeBoosterModule.isBackgroundBoostActive();
```

### Event Listeners

#### `audioDeviceChanged`
Emitted when audio output device changes.
```typescript
VolumeBoosterEmitter.addListener('audioDeviceChanged', (device: AudioDeviceInfo | null) => {
  console.log('Device changed:', device);
});
```

#### `volumeChanged`
Emitted when system volume level changes.
```typescript
VolumeBoosterEmitter.addListener('volumeChanged', (volume: number) => {
  console.log('Volume changed:', volume);
});
```

### Data Structures

#### `AudioDeviceInfo`
```typescript
interface AudioDeviceInfo {
  name: string;        // Device name
  type: string;        // Device type
  typeId: number;     // Android type ID
  id: number;         // Unique device ID
  channels: string;    // Supported channels
  encodings: string;   // Supported encodings
  sampleRates: string; // Supported sample rates
}
```

## 🛠️ Development Guide

### Prerequisites
- Node.js 20+
- React Native 0.81+
- Android Studio
- Android SDK 21+

### Setup Instructions

1. **Clone and Install**
```bash
git clone <repository-url>
cd VolumeBooster
npm install
```

2. **Android Setup**
```bash
cd android
./gradlew clean
cd ..
npx react-native run-android
```

3. **Development Commands**
```bash
npm start          # Start Metro bundler
npm run android    # Run on Android
npm run lint       # Run ESLint
npm test           # Run tests
```

### Code Organization

#### Adding New Features
1. **UI Changes**: Modify `src/components/VolumeBooster.tsx`
2. **Native Methods**: Add to `VolumeBoosterModule.kt`
3. **Background Service**: Add to `VolumeBoosterService.kt` ⭐ **NEW**
4. **TypeScript Interface**: Update `VolumeBoosterModule.ts`
5. **Documentation**: Update this file and README.md

#### Boost Level Customization
To modify boost levels, update these values:

**Android Native Module** (`VolumeBoosterModule.kt`):
```kotlin
// Change multiplier to adjust gain per percentage
loudnessEnhancer?.setTargetGain(boostLevel * 25) // 25 = current multiplier
```

**React Native UI** (`VolumeBooster.tsx`):
```typescript
// Change maximum boost level
maximumValue={200} // 200 = current maximum
```

### Testing

#### Manual Testing
1. **Volume Control**: Test slider responsiveness
2. **Boost Functionality**: Use test sound to verify boost
3. **Mode Switching**: Test app-only vs device-wide modes
4. **Device Monitoring**: Connect/disconnect audio devices
5. **Safety Warnings**: Test high boost level warnings
6. **Theme Switching**: Test dark/light theme changes
7. **Background Mode**: ⭐ **NEW** - Test background service functionality
8. **Service Status**: ⭐ **NEW** - Verify service health monitoring
9. **Notification Display**: ⭐ **NEW** - Check persistent notification
10. **App Lifecycle**: ⭐ **NEW** - Test boost continuity when app is closed

#### Automated Testing
```bash
npm test                    # Run unit tests
npm run test:coverage       # Run with coverage
npm run test:watch          # Watch mode
```

## 🔧 Integration Guide - Use in Your Own Project

### 📋 Prerequisites
- React Native 0.81+ project
- Android development environment
- Node.js 16+

### 📦 Required Dependencies

Add these to your `package.json`:
```json
{
  "dependencies": {
    "@react-native-community/slider": "^4.4.2",
    "react-native-navigation-bar-color": "^2.0.1",
    "react-native-safe-area-context": "^4.7.4"
  }
}
```

Install with:
```bash
npm install @react-native-community/slider react-native-navigation-bar-color react-native-safe-area-context
```

### 📁 Files to Copy

#### **1. React Native Components**
Copy these files to your project:

```
src/
├── components/
│   └── VolumeBooster.tsx          # Main UI component (self-contained with themes)
└── modules/
    └── VolumeBoosterModule.ts     # TypeScript interface
```

#### **2. Android Native Files**
Copy these files to your Android project:

```
android/app/src/main/java/com/volumebooster/
├── VolumeBoosterModule.kt         # Core audio processing
├── VolumeBoosterService.kt       # Background foreground service ⭐ NEW
├── VolumeBoosterPackage.kt       # Module registration
└── MainApplication.kt            # Updated with package registration
```

### ⚙️ Step-by-Step Integration

#### **Step 1: Copy React Native Files**
```bash
# Copy the main component
cp src/components/VolumeBooster.tsx your-project/src/components/

# Copy the module interface
cp src/modules/VolumeBoosterModule.ts your-project/src/modules/
```

#### **Step 2: Copy Android Native Files**
```bash
# Copy native modules
cp android/app/src/main/java/com/volumebooster/VolumeBoosterModule.kt your-project/android/app/src/main/java/com/volumebooster/
cp android/app/src/main/java/com/volumebooster/VolumeBoosterService.kt your-project/android/app/src/main/java/com/volumebooster/ ⭐ NEW
cp android/app/src/main/java/com/volumebooster/VolumeBoosterPackage.kt your-project/android/app/src/main/java/com/volumebooster/
```

#### **Step 3: Update Android MainApplication.kt**
Add the VolumeBoosterPackage to your `MainApplication.kt`:

```kotlin
import com.volumebooster.VolumeBoosterPackage

class MainApplication : Application(), ReactApplication {
    // ... existing code ...
    
    override fun getPackages(): List<ReactPackage> {
        return listOf(
            MainReactPackage(),
            VolumeBoosterPackage()  // Add this line
        )
    }
}
```

#### **Step 4: Update Android Manifest** ⭐ **NEW**
Add required permissions and service declaration to your `AndroidManifest.xml`:

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- Existing permissions -->
    <uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS"/>
    <uses-permission android:name="android.permission.RECORD_AUDIO"/>
    
    <!-- Background service permissions -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK" />
    <uses-permission android:name="android.permission.WAKE_LOCK" />

    <application>
        <!-- Existing components -->
        
        <!-- VolumeBoosterService for background audio boost -->
        <service
            android:name=".VolumeBoosterService"
            android:enabled="true"
            android:exported="false"
            android:foregroundServiceType="mediaPlayback" />
    </application>
</manifest>
```

#### **Step 5: Update Package Names**
Update the package name in the copied Kotlin files to match your app:
```kotlin
// Change from:
package com.volumebooster

// To your package:
package com.yourapp.package
```

#### **Step 6: Add to Your App**
Import and use the component in your app:

```tsx
import React from 'react';
import { VolumeBooster } from './src/components/VolumeBooster';

function App() {
  return (
    <View style={{ flex: 1 }}>
      <VolumeBooster />
    </View>
  );
}
```

### 🎨 Customization Options

#### **Theme Customization**
The `VolumeBooster.tsx` component contains both dark and light themes. Modify the theme objects:

```tsx
// In VolumeBooster.tsx, modify these objects:
const darkTheme: Theme = {
  background: '#000000',      // Background color
  primary: '#CCFF00',        // Primary accent color
  secondary: '#F92672',      // Warning/danger color
  sliderTrackBackground: '#999999', // Slider track background
  // ... other colors
};

const lightTheme: Theme = {
  background: '#FFFFFF',      // Background color
  primary: '#1976D2',        // Primary accent color
  secondary: '#D32F2F',      // Warning/danger color
  sliderTrackBackground: '#444444', // Slider track background
  // ... other colors
};
```

#### **Boost Level Customization**
Modify boost limits in `VolumeBoosterModule.kt`:

```kotlin
// Change maximum boost level (currently 200%)
loudnessEnhancer?.setTargetGain(boostLevel * 25)  // 25 = gain multiplier

// To increase max boost to 400%:
// Change slider maximumValue to 400 in VolumeBooster.tsx
// Formula: 400 * 25 = 10,000 mB = 100 dB (Android's theoretical max)
```

#### **UI Customization**
All styling is contained in `VolumeBooster.tsx`. Modify the `styles` object:

```tsx
const styles = StyleSheet.create({
  container: {
    flex: 1,
    // Add your custom styles
  },
  // ... other styles
});
```

### 🔧 Advanced Integration

#### **Standalone Component**
The `VolumeBooster` component is completely self-contained and can be used anywhere:

```tsx
import { VolumeBooster } from './src/components/VolumeBooster';

// Use as a screen
function VolumeScreen() {
  return <VolumeBooster />;
}

// Use as a modal
function App() {
  const [showVolume, setShowVolume] = useState(false);
  
  return (
    <View>
      <Button title="Open Volume Booster" onPress={() => setShowVolume(true)} />
      {showVolume && (
        <Modal>
          <VolumeBooster />
        </Modal>
      )}
    </View>
  );
}
```

#### **Custom Integration**
Extract specific functionality:

```tsx
// Use only the native module for custom UI
import { VolumeBoosterModule } from './src/modules/VolumeBoosterModule';

function CustomVolumeControl() {
  const [boost, setBoost] = useState(0);
  
  const handleBoost = async (value: number) => {
    await VolumeBoosterModule.setBoost(value);
    setBoost(value);
  };
  
  return (
    <View>
      <Text>Boost: {boost}%</Text>
      <Slider onValueChange={handleBoost} />
    </View>
  );
}
```

### 📱 Platform Support

- **Android**: ✅ Fully supported
- **iOS**: ⚠️ Not implemented (can be added using AVAudioEngine)

### 🔐 Required Android Permissions

Add these permissions to your `android/app/src/main/AndroidManifest.xml`:

```xml
<uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" />
<uses-permission android:name="android.permission.RECORD_AUDIO" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
```

**Permission Explanations:**
- `MODIFY_AUDIO_SETTINGS`: Required for volume control and audio enhancement
- `RECORD_AUDIO`: Required for audio session management and device monitoring
- `WRITE_EXTERNAL_STORAGE`: Required for audio file operations (test sound)

### 🐛 Troubleshooting

#### **Common Issues**

1. **"Module not found" error**
   - Ensure `VolumeBoosterPackage` is added to `MainApplication.kt`
   - Check package names match in all files

2. **Audio not boosting**
   - Verify Android permissions in `AndroidManifest.xml`
   - Check if device supports LoudnessEnhancer API

3. **Build errors**
   - Clean and rebuild: `cd android && ./gradlew clean && cd .. && npx react-native run-android`
   - Check React Native version compatibility

4. **Theme not switching**
   - Ensure `useColorScheme` is imported
   - Check if system theme detection is working

5. **Background service not starting** ⭐ **NEW**
   - Verify foreground service permissions in `AndroidManifest.xml`
   - Check if `VolumeBoosterService` is properly declared
   - Ensure `FOREGROUND_SERVICE_MEDIA_PLAYBACK` permission is added

6. **Background boost not working** ⭐ **NEW**
   - Check if background mode is enabled in UI
   - Verify service status in notification bar
   - Check service health monitoring logs
   - Ensure boost level is set before enabling background mode

#### **Debug Information**
Enable debug logging in `VolumeBoosterModule.kt`:

```kotlin
Log.d("VolumeBooster", "Boost level: $boostLevel")
Log.d("VolumeBooster", "Audio session: $audioSessionID")
Log.d("VolumeBooster", "Background mode: $isBackgroundModeEnabled") ⭐ NEW
Log.d("VolumeBooster", "Service running: $isServiceBound") ⭐ NEW
```

Enable debug logging in `VolumeBoosterService.kt`:

```kotlin
Log.d("VolumeBoosterService", "Service started with boost: $currentBoostLevel")
Log.d("VolumeBoosterService", "App-only mode: $isAppOnlyBoost")
Log.d("VolumeBoosterService", "Boost enabled: $isBoostEnabled")
```

### 📚 Complete File List

Here's exactly what you need to copy for full integration:

```
📁 Files to Copy:
├── src/components/VolumeBooster.tsx          # Main UI (self-contained)
├── src/modules/VolumeBoosterModule.ts        # TypeScript interface
├── android/app/src/main/java/com/volumebooster/
│   ├── VolumeBoosterModule.kt               # Core audio logic
│   ├── VolumeBoosterService.kt             # Background service ⭐ NEW
│   └── VolumeBoosterPackage.kt              # Module registration
├── Update MainApplication.kt                # Add package registration
└── Update AndroidManifest.xml               # Add permissions & service ⭐ NEW

📦 Dependencies to Install:
├── @react-native-community/slider
├── react-native-navigation-bar-color
└── react-native-safe-area-context
```

### 🎯 Quick Integration Checklist

- [ ] Install required npm packages
- [ ] Copy `VolumeBooster.tsx` to your components
- [ ] Copy `VolumeBoosterModule.ts` to your modules
- [ ] Copy Android native files
- [ ] Update package names in Kotlin files
- [ ] Add `VolumeBoosterPackage` to `MainApplication.kt`
- [ ] Import and use `<VolumeBooster />` in your app
- [ ] Test on Android device

That's it! You now have a complete volume boosting system in your React Native app! 🎉

## 🔧 Troubleshooting

### Common Issues

#### Audio Not Boosting
- **Check**: Android permissions (`MODIFY_AUDIO_SETTINGS`, `RECORD_AUDIO`)
- **Verify**: Native module initialization
- **Test**: Use test sound button
- **Solution**: Restart app or device

#### Device Monitoring Not Working
- **Check**: Background app restrictions
- **Verify**: Event listener setup
- **Test**: Connect/disconnect audio device
- **Solution**: Restart monitoring or app

#### High Boost Causes Distortion
- **Expected**: Normal behavior at high levels
- **Solution**: Reduce boost level or device volume
- **Warning**: Monitor audio quality and speaker safety

#### App Crashes on Boost Change
- **Check**: Native module error handling
- **Verify**: Boost level within valid range (0-200%)
- **Solution**: Check logs and restart app

#### Theme Not Switching
- **Check**: `useColorScheme` import
- **Verify**: System theme detection
- **Test**: Change device theme settings
- **Solution**: Restart app or check theme implementation

### Debug Information

#### Enable Debug Logging
```typescript
// In VolumeBooster.tsx
console.log('Boost level:', boost);
console.log('Device info:', deviceInfo);
console.log('Current theme:', colorScheme);
```

#### Android Logs
```bash
adb logcat | grep VolumeBooster
```

#### React Native Debugger
```bash
npx react-native start --reset-cache
```

### Performance Optimization

#### Memory Management
- Native module properly releases audio resources
- Event listeners are cleaned up on unmount
- Background monitoring stops when not needed

#### Battery Optimization
- Monitoring frequencies optimized for responsiveness vs battery
- Audio processing only active when boost is applied
- Proper cleanup prevents resource leaks

## 📄 License

This is an open-source React Native implementation of advanced audio enhancement functionality.

This project is open-source and freely available for use, modification, and integration into your own applications. We encourage you to contribute back to the community by sharing your improvements or adaptations, helping others to learn and benefit from your work.

**VolumeBooster** - React Native implementation with comprehensive features and documentation.
